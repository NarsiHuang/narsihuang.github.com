---
layout: post
title: 过桥问题
category: tech
description: 之前笔试时遇到一道题目，印象中似乎在哪里见过，但之前一直没在意，因此做的时候卡在了那里，思考一段时间后也没能当场解决出来。题目大意如下：小明和爸爸、妈妈、弟弟、爷爷一起要通过一座桥，由于是夜晚，必须打灯才能通过。桥上一次最多只能通过两人。小明过桥······
---
之前笔试时遇到一道题目，印象中似乎在哪里见过，但之前一直没在意，因此做的时候卡在了那里，思考一段时间后也没能当场解决出来。

题目大意如下：

>小明和爸爸、妈妈、弟弟、爷爷一起要通过一座桥，由于是夜晚，必须打灯才能通过。桥上一次最多只能通过两人。小明过桥需要 1 分钟，爸爸需要 2 分钟，弟弟需要 3 分钟，妈妈需要 6 分钟，爷爷需要 18 分钟，两人一起过桥时时间按速度较慢者过桥时间算。他们只有一盏灯，且等只能点亮 30 分钟，问怎样过桥所用时间最短，并用程序实现。

当时第一反应是让速度最快的人来回护送其他人通过，那么所用总时间就是送爷爷的时间 + 小明返回时间 + 送妈妈时间 + 小明返回时间 + 送弟弟时间 + 小明返回时间 + 和爸爸一起通过时间，设小明、爸爸、弟弟、妈妈、爷爷过桥所用时间分别为 T<sub>1</sub>、T<sub>2</sub>、T<sub>3</sub>、T<sub>4</sub>、T<sub>5</sub>，所用总时间为 T<sub>S</sub>，则：

<pre>T<sub>S</sub> = T<sub>5</sub> + T<sub>1</sub> + T<sub>4</sub> + T<sub>1</sub> + T<sub>3</sub> + T<sub>1</sub> + T<sub>2</sub> 
   = 18 + 1 + 6 + 1 + 3 + 1 + 2
   = 32
</pre> 

然而这样计算的总时间已经超过了 30 分钟，因此显然并不是最优的方法。这里暂时将这个方法定义为「方法一」。

回家仔细思考后发现有更快地通过方式。这里约定每过一次桥为「一趟」，则过桥方式文字表述如下：

>第一趟：小明和爸爸一起通过，所用时间为T<sub>2</sub>。  
>第二趟：小明返回，所用时间为T<sub>1</sub>。  
>第三趟：爷爷和妈妈一起通过，所用时间为T<sub>5</sub>。  
>第四趟：爸爸返回，所用时间为T<sub>2</sub>。  
>第五趟：小明和弟弟一起通过，所用时间为T<sub>3</sub>。  
>第六趟：小明返回，所用时间为T<sub>1</sub>。  
>第七趟：小明和爸爸一起通过，所用时间为T<sub>2</sub>。

因此总时间为：
<pre>T<sub>S</sub> = T<sub>2</sub> + T<sub>1</sub> + T<sub>5</sub> + T<sub>2</sub> + T<sub>3</sub> + T<sub>1</sub> + T<sub>2</sub>
   = 2 + 1 + 18 + 2 + 3 + 1 + 2
   = 29
</pre>

以上方法定义为「方法二」。这样更快之所以更快是因为最慢的人和次慢的人一起通过，就可以减少总时间。总时间的决定因素在于速度慢的人需要花费多少时间而不是速度快的人花费多少，这有点类似于木桶原理。

将此问题一般化，假设有 N 个人过桥，所需时间从少到多依次为 T<sub>1</sub>， T<sub>2</sub>， T<sub>3</sub>， ···， T<sub>N-1</sub>， T<sub>N</sub>，（同时 N 个人分别表示为 1， 2， 3， ···， N-1， N），那么问题要稍微复杂一些，不能单纯的使用「方法二」让最慢的和次慢的一起通过，因为如果次慢者的速度和次快者速度相差不大，那么这也许就不再是最优的方法，考虑如下情况：
>四个人所需时间分别为：  
>T<sub>1</sub> = 1  
>T<sub>2</sub> = 2  
>T<sub>3</sub> = 2  
>T<sub>4</sub> = 3

则「方法二」过桥方式如下图，约定 A 地为未过桥时的地方，B 地为过桥后的位置， `====>` 符号表示从 A 地过桥至 B 地，`<====` 表示从 B 地过桥返回 A 地，两侧数字分别表示这一趟过桥结束后两地所有的人：

	   A 地           B 地
	   3, 4   ====>   1, 2
	1, 3, 4  <====    2
	      1   ====>   2, 3, 4
	   1, 2  <====    3, 4
	          ====>   1, 2, 3, 4

所需时间为：
<pre>T<sub>S2</sub> = T<sub>2</sub> + T<sub>1</sub> + T<sub>4</sub> + T<sub>2</sub> + T<sub>2</sub>
    = 2 + 1 + 3 + 2 + 2
    = 10
</pre>

而「方法一」方式如下图：

	   A 地           B 地
	   2, 3   ====>   1, 4
	1, 2, 3  <====    4
	      2   ====>   1, 3, 4
	   1, 2  <====    3, 4
	          ====>   1, 2, 3, 4

所需时间为：
<pre>T<sub>S1</sub> = T<sub>4</sub> + T<sub>1</sub> + T<sub>3</sub> + T<sub>1</sub> + T<sub>2</sub>
    = 3 + 1 + 2 + 1 + 2
    = 9
</pre>

此时「方法一」所用时间就短于「方法二」，思考后发现这两种方法的区别在于前三趟，列出公式比较：
<pre>
T<sub>S1</sub> -  T<sub>S2</sub> = (T<sub>1</sub> + T<sub>3</sub>) - (T<sub>2</sub> + T<sub>2</sub>)
</pre>

因此当最快者和次慢者所用时间之和大于 2 倍次快者所用时间时，「方法二」所用时间短，反之则「方法一」所用时间短。当然四个人时还有更多的方法可以过桥，但其余方法所用时间都明显会大于「方法一」和「方法二」。

推广到更多人时，依然以每四个人为最小单位（当人数为三人时最短时间就是单纯的三人所需时间相加）进行如上的判断，使用「方法一」或者「方法二」，这样看作一个整体计算一次后，A 地剩余人数就减少 2，再递归调用，直至 A 地剩余人数少于四人。

使用 PHP 实现的程序如下：

	/**
	 * 过桥问题算法实现
	 *
	 * @param array $per_time 所有人过桥分别所需的时间
	 * @param int   $time     初始需要使用的总时间，默认0
	 *
	 * @return int 需要使用的总时间
	 */
	function crossBridge(array $per_time, $time = 0)
	{
	    sort($per_time);                    // 将时间数组按从小到大排序
	    $count = count($per_time);          // 计算人数
	    if ($count < 2) {                     // 剩余人数少于2时返回总时间
	        return $time;
	    }
	    // 判断最快者和次慢者所用时间和大于2倍次快者，使用「方法二」。
	    if (2 * $per_time[1] < $per_time[0] + $per_time[$count - 2] && $count > 3) {
	        $time += $per_time[1] + $per_time[0] + $per_time[$count - 1] + $per_time[1];
	    } // 否则使用「方法一」。
	    else if ($count > 3) {
	        $time += $per_time[$count - 1] + $per_time[0] + $per_time[$count - 2] + $per_time[0];
	    } // 只剩三人时，剩余人所需时间相加。
	    else if ($count == 3) {
	        $time += $per_time[0] + $per_time[1] + $per_time[2];
	    } // 剩余两人时，所需时间为慢者所需时间。
	    else {
	        $time += $per_time[1];
	    }
	    array_pop($per_time);                 // 减少两人
	    array_pop($per_time);

	    return crossBridge($per_time, $time); // 递归调用
	}

用小明那道题数据来做测试：

	$per_time = array(1, 2, 5, 10);
	echo '过桥所需最少时间为' . crossBridge($per_time) . ' 分钟。';

结果为：

	过桥所需最少时间为 29 分钟。

这样算出来的结果就是最短所需的时间了。